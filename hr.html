<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HR Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
  </style>
</head>
<body>
  <div style="background-color: rgba(0, 0, 255, 0.603);height: 60px;text-align: center;justify-content: center;">
    <h1 style="color: white;text-shadow: 2px 2px 20px black;">Aritrak Technologies</h1>
  </div>

  <hr>
  <h2 style="text-align: center;">HR Dashboard</h2>
  <br>

  <div class="filter-group">
    <div>
      <label><b>Search by Primary Domain:</b></label>
      <select id="SearchPrimaryDomain">
        <option value="">Select Primary Skill</option>
        <option value="Embedded Systems">Embedded Systems</option>
        <option value="Physical Design">Physical Design</option>
        <option value="Analog Design">Analog Design</option>
        <option value="Memory Layout">Memory Layout</option>
        <option value="DFT">DFT</option>
        <option value="Mobile App Development">Mobile App Development</option>
      </select>
    </div>

    <div>
      <label><b>Search by Secondary Domain:</b></label>
      <input type="text" id="SearchSecondaryDomain" placeholder="Secondary Skill"/>
    </div>

    <div>
      <label><b>Search by Skills:</b></label>
      <select id="SearchSkill">
        <option value="">Select Skill</option>
        <option value="Java">Java</option>
        <option value="Python">Python</option>
        <option value="Node.js">Node.js</option>
        <option value="C">C</option>
        <option value="C++">C++</option>
        <option value="SQL">SQL</option>
        <option value="NoSQL">NoSQL</option>
        <option value="React">React</option>
        <option value="JavaScript">JavaScript</option>
        <option value="MongoDB">MongoDB</option>
        <option value="MERN">MERN</option>
        <option value="MEAN">MEAN</option>
      </select>
    </div>

    <div style="align-self: end;">
      <button type="submit" onclick="filterResumes()" class="btn btn-primary">
        Search
      </button>
    </div>
  </div>

  <table id="resumesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Contact</th>
        <th>Email</th>
        <th>Primary Domain</th>
        <th>Secondary Domain</th>
        <th>Skills</th>
        <th>Experience</th>
        <th>Current CTC</th>
        <th>Expected CTC</th>
        <th>Notice Period</th>
        <th>Current Location</th>
        <th>Preferred Location</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allResumes = [];

    window.onload = async function() {
      const res = await fetch("/resumes");
      allResumes = await res.json();
      renderTable(allResumes);
    };

    function renderTable(resumes) {
      const tableBody = document.querySelector("#resumesTable tbody");
      tableBody.innerHTML = "";

      if (resumes.length === 0) {
        const noDataRow = `<tr><td colspan="12" style="text-align:center;color:red;">
          No profile found on this skill
        </td></tr>`;
        tableBody.innerHTML = noDataRow;
        return;
      }

      resumes.forEach((resume) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${resume.name || ""}</td>
          <td>${resume.contact || ""}</td>
          <td>${resume.email || ""}</td>
          <td>${resume.primaryDomain || ""}</td>
          <td>${resume.secondaryDomain || ""}</td>
          <td>${Array.isArray(resume.skills) ? resume.skills.join(", ") : (resume.skills || "")}</td>
          <td>${resume.experience || ""}</td>
          <td>${resume.currentCTC || ""}</td>
          <td>${resume.expectedCTC || ""}</td>
          <td>${resume.noticePeriod || ""}</td>
          <td>${resume.currentLocation || ""}</td>
          <td>${resume.preferredLocation || ""}</td>
        `;
        tableBody.appendChild(row);
      });
    }

   
    function filterResumes() {
      const primaryDomain = document.getElementById("SearchPrimaryDomain").value.trim().toLowerCase();
      const secondaryDomain = document.getElementById("SearchSecondaryDomain").value.trim().toLowerCase();
      const skill = document.getElementById("SearchSkill").value.trim().toLowerCase();

      const filtered = allResumes.filter((resume) => {
        const matchPrimary = primaryDomain
          ? (resume.primaryDomain || "").toLowerCase() === primaryDomain
          : true;

        const matchSecondary = secondaryDomain
          ? (resume.secondaryDomain || "").toLowerCase().includes(secondaryDomain)
          : true;

        const matchSkill = skill
          ? (() => {
              let skillsArray = [];
              if (Array.isArray(resume.skills)) {
                skillsArray = resume.skills;
              } else if (typeof resume.skills === "string") {
                skillsArray = resume.skills.split(","); // split if comma separated
              }
              return skillsArray.some(s => s.trim().toLowerCase() === skill || s.trim().toLowerCase().includes(skill));
            })()
          : true;

        return matchPrimary && matchSecondary && matchSkill;
      });

      renderTable(filtered);
    }
  </script>
</body>
</html>

